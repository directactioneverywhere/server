{
  "builders": [
  {
    "type": "digitalocean",
    "region": "sfo1",
    "size": "512mb",
    "image": "ubuntu-14-04-x64",
    "snapshot_name": "dxe-image-{{timestamp}}"
  }],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "sleep 30",
        "sudo apt-get update",
        "sudo apt-get install -y python-dev python-pip nginx upstart",
        "sudo DEBIAN_FRONTEND=noninteractive apt-get install -y postfix",
        "mkdir -p /opt/dxe/airtable",
        "mkdir -p /opt/dxe/health",
        "mkdir -p /var/www/maps"
      ]
    }, {
      "type": "file",
      "source": "build/requirements.txt",
      "destination": "/opt/dxe/requirements.txt"
    }, {
      "type": "shell",
      "inline": [
        "sudo pip install -r /opt/dxe/requirements.txt"
      ]
    }, {
      "type": "file",
      "source": "build/crontab",
      "destination": "/opt/dxe/crontab"
    }, {
      "type": "shell",
      "inline": [
        "sudo crontab /opt/dxe/crontab"
      ]
    }, {
      "type": "file",
      "source": "build/conf/nginx.conf",
      "destination": "/tmp/nginx.conf"
    }, {
      "type": "shell",
      "inline": [
        "sudo mv /tmp/nginx.conf /etc/nginx/sites-enabled/default"
      ]
    },

    {
      "type": "file",
      "source": "airtable/backup_airtable.py",
      "destination": "/opt/dxe/airtable/backup_airtable.py"
    }, {
      "type": "file",
      "source": "airtable/run_backup_airtable.sh",
      "destination": "/opt/dxe/airtable/run_backup_airtable.sh"
    }, {
      "type": "file",
      "source": "config/airtable.sh",
      "destination": "/opt/dxe/airtable/conf.sh"
    }, {
      "type": "shell",
      "inline": [
        "sudo chmod +x /opt/dxe/airtable/run_backup_airtable.sh"
      ]
    },

    {
      "type": "file",
      "source": "airtable/generate_chapter_data.py",
      "destination": "/opt/dxe/airtable/generate_chapter_data.py"
    }, {
      "type": "file",
      "source": "airtable/run_generate_chapter_data.sh",
      "destination": "/opt/dxe/airtable/run_generate_chapter_data.sh"
    }, {
      "type": "file",
      "source": "airtable/generate_chapter_data.py",
      "destination": "/opt/dxe/airtable/generate_chapter_data.py"
    }, {
      "type": "file",
      "source": "maps/chapter_map.html",
      "destination": "/var/www/maps/chapter_map.html"
    }, {
      "type": "file",
      "source": "maps/add_map.js",
      "destination": "/var/www/maps/add_map.js"
    }, {
      "type": "file",
      "source": "maps/dxe_marker.png",
      "destination": "/var/www/maps/dxe_marker.png"
    }, {
      "type": "shell",
      "inline": [
        "sudo chmod +x /opt/dxe/airtable/run_generate_chapter_data.sh",
        "/opt/dxe/airtable/run_generate_chapter_data.sh"
      ]
    },

    {
      "type": "file",
      "source": "health/health.py",
      "destination": "/opt/dxe/health/health.py"
    }, {
      "type": "file",
      "source": "health/__init__.py",
      "destination": "/opt/dxe/health/__init__.py"
    }, {
      "type": "file",
      "source": "health/run_health.sh",
      "destination": "/opt/dxe/health/run_health.sh"
    }, {
      "type": "file",
      "source": "build/conf/upstart-health.conf",
      "destination": "/etc/init/health.conf"
    }, {
      "type": "shell",
      "inline": [
        "sudo chmod +x /opt/dxe/health/run_health.sh"
      ]
    }
  ]
}
